
---

title: "Batch-Betrieb über das Commandline-Tool"
author: ['Jens Kupferschmidt']
mcr_version: ['2019.06','2020.06']
description: "
      Der Abschnitt beschreibt Vorgehensweisen bei der Nutzung des CLI im Batch-Betrieb.
    "
date: "2020-06-04"

---

    <div>
      <h2>Allgemeines</h2>
      <p>
        Neben der interaktiven Arbeit über die WEB-Oberfläche kann es bei Produktivanwendungen immer wieder zu dem
        Erfordernis kommen, via Script Änderungen an den Daten vornehmen zu müssen. Hierfür können die MyCoRe-Kommandos
        in Shell-Scripts eingebunden werden. Neben Kommandos für eine feste Gruppe von Daten oder die Auswahl aller
        Daten bietet die <a href="{{< ref cli_overview >}}">MyCoRe Kommandozeile</a> auch die Möglichkeit Daten zu selektieren 
        und dann auf diese Auswahl zuzugreifen.
      </p>
      <p>
        Grundsätzlich wird hierbei zunächst eine Menge von Werten (typischerweise Objekt-IDs) selektiert
        und anschließend entweder
      </p>
      <ul>
        <li>eines der unten genannten Kommandos ausgeführt, dass mit dieser Auswahl arbeitet, oder</li>
        <li>ein anderes Kommando für alle selektierten Werte ausgeführt.</li>
      </ul>
    </div>

    <div>
      <h2>Erstellen einer Auswahl</h2>
      Eine Auswahl kann explizit als mit Leerzeichen separierte Liste angegeben werden:
      <p>
        <code>mycore.sh select values {0}</code>
      </p>
      Eine Auswahl von Object IDs kann per XPath erfolgen,
      wobei alle (normalisierten) Objekte geprüft werden:
      <p>
        <code>mycore.sh select objects with xpath {0}</code>
      </p>
      Eine Auswahl von Object IDs kann per XPath erfolgen,
      wobei alle (expandierten) Objekte geprüft werden:
      <p>
        <code>mycore.sh select expanded objects with xpath {0}</code>
      </p>
      Eine Auswahl von Object IDs kann per XPath erfolgen,
      wobei alle Derivate geprüft werden:
      <p>
        <code>mycore.sh select derivates with xpath {0}</code>
      </p>
      Eine Auswahl von Object IDs kann per Solr Query erfolgen:
      <p>
        <code>mycore.sh select objects with solr query {0} in core {1}</code>
      </p>
    </div>

    <div>
      <h2>Reduzieren einer Auswahl</h2>
      Eine Auswahl von Object IDs kann per XPath reduziert werden,
      wobei für alle bereits ausgewählten Objekt-IDs das zugehörige (normalisierten) Objekte geprüft werden:
      <p>
        <code>mycore.sh filter object selection with xpath {0}</code>
      </p>
      Eine Auswahl von Object IDs kann per XPath reduziert werden,
      wobei für alle bereits ausgewählten Objekt-IDs das zugehörige (expandierte) Objekte geprüft werden:
      <p>
        <code>mycore.sh filter expanded object selection with xpath {0}</code>
      </p>
      Eine Auswahl von Object IDs kann per XPath reduziert werden,
      wobei für alle bereits ausgewählten Objekt-IDs das zugehörige Derivat geprüft werden:
      <p>
        <code>mycore.sh filter dereivate selection with xpath {0}</code>
      </p>
    </div>


    <div>
      <h2>Kommandos für ausgewählte Daten</h2>
      <p>Nach erfolgreicher Auswahl können dann u. a. die folgenden Kommandos für die selektierten
        Werte aufgerufen werden.
      </p>

      <div>
        <h3>Allgemeine Kommandos</h3>
        <dl>
          <dt>
            <code>mycore.sh list selected</code>
          </dt>
          <dd>
            Listet alle ausgewählten Werte auf
          </dd>
          <dt>
            <code>mycore.sh execute for selected {0}</code>
          </dt>
          <dd>
            Führt für alle ausgewählten Werte ein anderes Kommando aus
          </dd>
        </dl>
      </div>

      <div>
        <h3>Kommandos für SOLR</h3>
        <p><span style="color:red">Achtung, Kommandos für die SOLR-Indizierung sollten nicht im Batch, sondern nur direkt im CLI-Tool
        ausgeführt werden. Es ist auch darauf zu achten, dass mit dem <code>quit</code>-Befehl gewartet wird, bis alle Responses von SOLR
        im CLI eingetroffen sind. Andernfalls kann es zu Datenverlusten im SOLR-Server kommen!</span></p>
        <dl>
          <dt>
            <code>mycore.sh rebuild solr metadata index for selected in core {0}</code>
          </dt>
          <dd>rebuilds solr's metadata index for selected objects
          </dd>
          <dt>
            <code>mycore.sh rebuild solr content index for selected in core {0}</code>
          </dt>
          <dd>rebuilds solr's content index for selected objects and or derivates
          </dd>
        </dl>
      </div>
      
      <div>
        <h3>Kommandos für Permissions</h3>
        <dl>
          <dt>
            <code>mycore.sh update permission {0} for selected with rulefile {1} described by {2}</code>
          </dt>
          <dd>The command updates access rule for a given permission and all ids of a given MCRObject-Type with a given special rule
          </dd>
          <dt>
            <code>mycore.sh update permission {0} for selected with rulefile {1}</code>
          </dt>
          <dd>The command updates access rule for a given permission and all ids of a given MCRObject-Type with a given special rule
          </dd>
          <dt>
            <code>mycore.sh delete permission {0} for selected</code>
          </dt>
          <dd>The command delete access rule for a query selected set of object ids of a given permission
          </dd>
          <dt>
            <code>mycore.sh delete all permissions for selected</code>
          </dt>
          <dd>The command delete all access rules for a query selected set of object ids
          </dd>
        </dl>
      </div>

      <div>
        <h3>Kommandos für METS-Daten</h3>
        <dl>
          <dt>
            <code>mycore.sh validate selected mets</code>
          </dt>
          <dd>validates all mets.xml of selected derivates
          </dd>
        </dl>
      </div>

    </div>
