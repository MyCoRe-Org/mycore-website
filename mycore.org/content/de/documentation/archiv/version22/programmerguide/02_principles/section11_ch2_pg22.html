
---

title: "Die Frontend-Komponenten"
description: "Funktionsprinzipien und Implementierungen von Kernkomponenten verschiedener Anwenderzugänge wie die MyCoRe-Kommandozeile und die Webanwendung."

---
   <div>
   <h2>Der Layout-Service</h2>
   <p>
     ToDo: Allgemeine Beschreibung des Layout-Services
   </p>

   <div>
   <h3>XSL-Info-Servlet</h3>
   <p>
     Das XSL-Info-Servlet hilft dabei die Übersicht über verwendete XSL-Stylesheets zu behalten.
     Dazu durchsucht es zur Laufzeit die Webanwendung (<code>WEB-INF/classes/xsl/</code> und alle
     <code>WEB-INF/lib/*.jar</code>) nach *.xsl-Stylesheets, listet deren Abhängigkeiten und die
     darin enthaltenen Templates. Das Ergebnis sieht etwa so aus, für ein einzelnes Stylesheet:
   </p>
   {{< highlight xml "linenos=table">}}
<stylesheet name="MCRMetadataSchema.xsl">
  <origin>lib/mycore-complete-2.1.80-SNAPSHOT.jar</origin>
  <includes>MCRMetadataTemplates.xsl</includes>
  <includes>MCRMetadataCoreTemplates.xsl</includes>
  <includes>MCRMetadataCoreTypes.xsl</includes>
  <includes>MCRMetadataTypes.xsl</includes>
  <xsl:template match="/"/>
  <xsl:template match="/configuration/structure"/>
  <xsl:template match="/configuration/metadata"/>
  <xsl:template match="/configuration/derivate"/>
  <xsl:template match="/configuration/service"/>
</stylesheet>
   {{< /highlight >}}
   <p>
     Das Element origin zeigt den Ursprung der XSL-Datei und kann evtl. mehrmals auftreten
     (etwa wenn das Stylesheet in <code>classes/xsl/</code> überschrieben wird).
   </p>
   <p>
     Um die Abhängigkeiten zu visualisieren, wandelt ein XSL-Stylesheet die Ausgabe in das
     GraphML-Format um. Das wiederum stelle ich mit CytoscapeWeb (GNU LGPL, Flash, JavaScript)
     im Browser dar. Den Graphen kann man nun zoomen und im Detail ansehen.
   </p>
   <p>
     Weitere Details werden in einer Tabelle ausgegeben, die man im Browser durchsuchen und
     filtern kann (JQuery Datatables). Die enthaltenen XSL-Templates können über Buttons
     aufgeklappt werden.
   </p>
   <p>
     Die Herkunft des Stylesheets wird farblich gekennzeichnet:
   </p>
   <ul>
     <li>grün - aus WEB-INF/classes/xsl/</li>
     <li>blau - aus *.jar</li>
     <li>gelb - zur Laufzeit eingebundene Stylesheets über URIs</li>
     <li>rot - Stylesheet wird referenziert, ist aber nicht auffindbar</li>
   </ul>
   <p>
     Das Frontend für das XSL-Info-Servlet ist als DocPortal-Modul verfügbar, das standardmäßig
     nicht eingebunden wird: <code>docportal/modules/xslinfo/</code>
     bzw. online unter <a href="http://www.mycore.de:8291/servlets/MCRXSLInfoServlet">http://www.mycore.de:8291/servlets/MCRXSLInfoServlet</a>
   </p>
   </div>

     <div>
       <h3>XSL-FO</h3>
       <p>
         Im LayoutService von MyCoRe ist es neben der Umsetzung von
         XML-Dateien via XSLT und dem Durchreichen von Daten auch möglich einen
         XSL:FO-Formatter anzusprechen. Dazu muss das eingehende XML den
         Content-Type "application/pdf" haben. Dann wird ein Spezialzweig
         angefaßt, bei dem eine spezielle Java-Klasse aufgerufen wird, die
         org.mycore.common.fo.MCRFoFormatterInterface implementiert. Im
         MyCoRe-Kern ist dies eine Klasse, welche den FOP aufruft und das
         Ergebnis ausliefert. Dazu muss dann eine anwenungspeziefische Klasse
         implementiert werden, die den gewünschten XSL:FO-Formatter (z.B.
         Antenna House) aufruft. Konfiguriert wird dies über:
       </p>
       {{< highlight bash "linenos=table">}}
##############################################################################
# XSL-FO Formatter
##############################################################################

  # Class that implements MCRFoFormatterInterface
  MCR.LayoutService.FoFormatter.class=org.mycore.common.fo.MCRFoFormatterFOP
  # Configuration file for FOP in classpath
  MCR.LayoutService.FoFormatter.FOP.config=myConfigFile
      {{< /highlight >}}
      <p>
        Für FOP kann noch eine Konfigurationsdatei im Classpath angegeben werden, die
        z. B. andere Fonts einsetzt.</p>
     </div>
   </div>


   <div>{{< mcr-figure src="/images/documentation/archiv/progguide_2frontend_mcrservlet.jpg" class="border border-secondary" label="" caption="" alt="Java-Klassen" width="" height="" />}}</div>

   <div>{{< mcr-figure src="/images/documentation/archiv/progguide_2frontend_mcrloginservletfluss.jpg" class="border border-secondary" label="" caption="" alt="MCRServlet.doGetPost()" width="" height="" />}}</div>

   <div>
    <h4>Generieren von Zip-Dateien</h4>
    <p>
    Das Zip-Servlet, implementiert durch die Klasse <code>MCRZipServlet</code>, dient dem Ausliefern der Derivate und
    der Objektmetadaten als gepackte Zip-Datei. Aus der Konfigurationsdatei <code>mycore.properties.zipper</code> holt
    sich das Servlet über die Variable <code>MCR.zip.metadata.transformer</code> den Namen des Stylesheets, welches die
    Metadatentransformation in das gewünschte Auslieferungsformat vornimmt. In DocPortal verwenden wir hierfür Qualified
    Dublin Core.
    </p>
    <p>Aufrufmöglichkeiten des Servlets:</p>
    {{< highlight java "linenos=table">}}
    $ServletsBaseURL/MCRZipServlet?id=MCRID

    $ServletsBaseURL/MCRZipServlet?id=MCRID/foldername
    {{< /highlight >}}
    <p>
    MCRID ist die ID eines Objekts vom Typ <code>&lt;mycoreobject&gt;</code> oder <code>&lt;mycorederivate&gt;</code>.
    Im Fall von <code>&lt;mycoreobject&gt;</code> werden die Dateien aller dem Objekt zugeordneten Derivate und ein
    XML-File mit den Metadaten des Objekts zusammengepackt. Im Fall von <code>&lt;mycorederivate&gt;</code> werden alle
    Dateien des angegebenen Derivates zusammengepackt. Die Option <code>MCRID/foldername</code> ist nur zulässig, wenn
    <code>MCRID</code> ein Objekt vom Typ <code>&lt;mycorederivate&gt;</code> bezeichnet. Dann wird nur der mit
    <code>foldername</code> angegebene Ordner des betreffenden Derivats gezippt.
    </p>
    <p>
    Wer geschützte Inhalte anbietet, sollte das Zip-Servlet erst dann in seine Anwendung integrieren, wenn die
    Zugriffskontrolle in MyCoRe gewährleistet werden kann. Dies ist momentan (04.2005) noch nicht der Fall, das
    Zip-Servlet lässt sich mit jeder MCRID aufrufen.
    </p>
   </div>

   <div>{{< mcr-figure src="/images/documentation/archiv/progguide_commandlinetool.jpg" class="border border-secondary" label="" caption="" alt="Java-Klassen" width="" height="" />}}</div>